<div class="page-container">
  <!-- Header -->
  <div class="header-row">
    <button class="btn btn-secondary" (click)="goBack()">â† Back to {{ positionName }}</button>
    <h2>{{ positionName }} â€“ Users</h2>
  </div>

  <p class="subtitle">Add position division and users under this position.</p>
  <!-- Division Selector -->
  <div class="form-group">
    <label class="form-label">Division </label>
    <select class="form-select" [(ngModel)]="selDivisionId">
      <option [value]="0">-- Select Division --</option>
      @for (division of div; track division.id) {
        <option [value]="division.id">{{ division.name }}</option>
      }
    </select>
  </div>

  <!-- Supervisor searchable input -->
  <div class="form-group">
    <label class="form-label">Supervisor</label>
    <input
      type="text"
      class="input-field"
      placeholder="Search for a supervisor..."
      [(ngModel)]="supervisorSearchQuery"
      (input)="filterSupervisors()"
      (focus)="showSupervisorDropdown = true"
    />

    <!-- Dropdown suggestions -->
    @if (showSupervisorDropdown && filteredSupervisors.length > 0) {
      <div class="search-dropdown">
        @for (supervisor of filteredSupervisors; track supervisor.id) {
          <div class="dropdown-item" (click)="selectSupervisor(supervisor)">
            {{ supervisor.name }}
          </div>
        }
      </div>
    }

    <!-- Selected supervisor display -->
    @if (selSupervisorId !== 0) {
      <div class="selected-chip">
        <span>{{ getSelSupervisorName() }}</span>
        <button class="chip-remove" (click)="clearSupervisor()">âœ•</button>
      </div>
    }
  </div>

  <!-- Save message -->
  @if (showMessage) {
    <div class="save-message">âœ… Users and Division saved successfully!</div>
  }

  <!-- Input row -->
  <div class="input-row">
    <input
      type="text"
      class="form-control"
      placeholder="Enter user name..."
      [(ngModel)]="newUser"
      (keydown)="onEnter($event)"
    />
    <button class="btn btn-primary" (click)="addUser()">+Add User</button>
  </div>

  <!-- Users list -->
  <div class="users-panel">
    <h5>
      Assigned Users <span class="badge">{{ users.length }}</span>
    </h5>

    @if (users.length === 0) {
      <div class="empty-state">
        No users assigned yet. Type a name above and click Add User or press Enter.
      </div>
    }

    @for (user of users; track user.id) {
      <div class="user-row">
        <span class="user-name">{{ user.name }}</span>
        <button class="btn btn-danger btn-sm" (click)="removeUser(user.id)">Remove</button>
      </div>
    }
  </div>

  <!-- exit buttons -->
  <div class="footer-actions">
    <button class="btn btn-secondary" (click)="goBack()">ğŸš« Cancel</button>
    <button class="btn btn-primary" (click)="save()">ğŸ’¾Save</button>
  </div>
</div>
